#!/usr/bin/env bash
# Run this from the root directory

source ./test/approvals.bash

export PATH=.:$PATH

cli=ass

describe "Help texts"
approve "$cli"
approve "$cli --help"

approve "$cli pkd"
approve "$cli pkd --help"

approve "$cli pkd aof"
approve "$cli pkd aof --help"

approve "$cli pkd aof list --help"

approve "$cli pkd proj"
approve "$cli pkd proj --help"

approve "$cli pkd proj list --help"

approve "$cli --version"

describe "pkd aof"
approve "$cli pkd aof ls --pkd-dir='test/resources/pkd'"

describe "pkd proj"
approve "$cli pkd proj ls --pkd-dir='test/resources/pkd'"

describe "todo append"
it "can append 'Append test'"

testtodo="$(mktemp --directory --tmpdir='/tmp' 'ass_todo_append.XXXX')"
cp test/resources/todo/* "$testtodo/."

$cli todo append --todotxt-file "$testtodo/todo.txt" "Append test"
approve "cat $testtodo/todo.txt" "ass_todo_append"

describe "todo delete"
it "can delete the 1st entry"

testtodo="$(mktemp --directory --tmpdir='/tmp' 'ass_todo_delete.XXXX')"
cp test/resources/todo/* "$testtodo/."

$cli todo delete --todotxt-file "$testtodo/todo.txt" 1
approve "cat $testtodo/todo.txt" "ass_todo_delete_1"

it "cannot delete a line that doesn't exist"
approve "$cli todo delete --todotxt-file /tmp/ass_todo_delete/todo.txt 10000" "ass_todo_delete_non_existent"

